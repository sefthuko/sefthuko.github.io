<html>
<head>
    <title>USGS Earthquake Feed</title>
    <meta http-equiv="Cache-Control" content="no-store" />

    <link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-1q8mTJOASx8j1Au+a5WDVnPi2lkFfwwEAa8hDDdjZlpLegxhjVME1fgjWPGmkzs7" crossorigin="anonymous">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js" type="text/javascript"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js" integrity="sha384-0mSbJDEHialfmuBBQP6A4Qrprq5OVfW37PRR3j5ELqxss1yVqOtnepnHVP9aJ7xS" crossorigin="anonymous"></script>

    <script src="https://connectors.tableau.com/libs/tableauwdc-2.0.latest.js" type="text/javascript"></script>
    <script>
(function() {
    // Create the connector object
    var myConnector = tableau.makeConnector();

    // Define the schema
    myConnector.getSchema = function(schemaCallback) {
        var config = JSON.parse(tableau.connectionData);

        if(config.type === "wholeNumberRange") {
            schemaCallback([{
                id: "wholeNumberRange",
                description: "Range of whole numbers",
                columns: [{
                             id: config.name,
                             description: config.description,
                             dataType: tableau.dataTypeEnum.int
                         }]
            }]);
        } else if(config.type === "decimalNumberRange") {
            schemaCallback([{
                id: "decimalNumberRange",
                description: "Range of decimal numbers",
                columns: [{
                             id: config.name,
                             description: config.description,
                             dataType: tableau.dataTypeEnum.float
                         }]
            }]);
        }
    };

    // Download the data
    myConnector.getData = function(table, doneCallback) {
        var config = JSON.parse(tableau.connectionData);

        if(config.type === "wholeNumberRange") {
            var tableData = [];
            if(config.step < 0) {
                for(var i = config.start; i >= config.end; i += config.step) {
                    var row = {};
                    row[config.name] = i; 
                    tableData.push(row);
                }
            } else if(config.step > 0) {
                for(var i = config.start; i <= config.end; i += config.step) {
                    var row = {};
                    row[config.name] = i; 
                    tableData.push(row);
                }
            }

            table.appendRows(tableData);
            doneCallback();
        } else if(config.type === "decimalNumberRange") {
            var tableData = [];
            if(config.step < 0) {
                for(var i = config.start; i >= config.end; i += config.step) {
                    var row = {};
                    row[config.name] = i; 
                    tableData.push(row);
                }
            } else if(config.step > 0) {
                for(var i = config.start; i <= config.end; i += config.step) {
                    var row = {};
                    row[config.name] = i; 
                    tableData.push(row);
                }
            }

            table.appendRows(tableData);
            doneCallback();
        } 
    };

    tableau.registerConnector(myConnector);

    // Create event listeners for when the user submits the form
    $(document).ready(function() {
        $("#submit-whole-number-range").click(function() {
            var rangeStart = parseInt($("#whole-number-range-start").val()); 
            var rangeEnd = parseInt($("#whole-number-range-end").val()); 
            var rangeStep = parseInt($("#whole-number-range-step").val()); 
            var rangeName = $("#whole-number-range-name").val(); 
            var rangeDescription = $("#whole-number-range-description").val(); 
            tableau.connectionName = "Start=" + rangeStart + ",End=" + rangeEnd + ",Step=" + rangeStep;
            tableau.connectionData = JSON.stringify({
                type: "wholeNumberRange",
                start: rangeStart,
                end: rangeEnd,
                step: rangeStep,
                name: rangeName,
                description: rangeDescription});
            tableau.submit();
        });

        $("#submit-decimal-number-range").click(function() {
            var rangeStart = parseFloat($("#decimal-number-range-start").val()); 
            var rangeEnd = parseFloat($("#decimal-number-range-end").val()); 
            var rangeStep = parseFloat($("#decimal-number-range-step").val()); 
            var rangeName = $("#decimal-number-range-name").val(); 
            var rangeDescription = $("#decimal-number-range-description").val(); 
            tableau.connectionName = "Start=" + rangeStart + ",End=" + rangeEnd + ",Step=" + rangeStep;
            tableau.connectionData = JSON.stringify({
                type: "decimalNumberRange",
                start: rangeStart,
                end: rangeEnd,
                step: rangeStep,
                name: rangeName,
                description: rangeDescription});
            tableau.submit();
        });
    });
})();
    </script>
</head>

<body>
    <div class="container container-table">

        <!--
        WHOLE NUMBER SEQUENCES
        -->

        <h3>Whole Number Sequences</h3>
        <form class="form-horizontal">
            <div class="form-group">
                <div class="col-sm-offset-2 col-sm-10">
                    <i>Generate a list of values between "Start" and "End", incrementing by "Step".  For example, for Start=1, End=6, Step=2, this will generate [1, 3, 5]</i>
                </div>
            </div>
            <div class="form-group">
                <label class="control-label col-sm-2" for="whole-number-range-name">Field Name:</label>
                <div class="col-sm-10">
                    <input type="text" class="form-control" id="whole-number-range-name" value="Number">
                </div>
            </div>
            <div class="form-group">
                <label class="control-label col-sm-2" for="whole-number-range-description">Field Description:</label>
                <div class="col-sm-10">
                    <input type="text" class="form-control" id="whole-number-range-description" value="A generated number sequence">
                </div>
            </div>
            <div class="form-group">
                <label class="control-label col-sm-2" for="whole-number-range-start">Start:</label>
                <div class="col-sm-10">
                    <input type="text" class="form-control" id="whole-number-range-start" value="1">
                </div>
            </div>
            <div class="form-group">
                <label class="control-label col-sm-2" for="whole-number-range-end">End:</label>
                <div class="col-sm-10">
                    <input type="text" class="form-control" id="whole-number-range-end" value="6">
                </div>
            </div>
            <div class="form-group">
                <label class="control-label col-sm-2" for="whole-number-range-step">Step:</label>
                <div class="col-sm-10">
                    <input type="text" class="form-control" id="whole-number-range-step" value="2">
                </div>
            </div>
            <div class="form-group">
                <div class="col-sm-offset-2 col-sm-10">
                    <button type="button" id="submit-whole-number-range" class="btn btn-default">Create</button>
                </div>
            </div>
        </form>

        <!--
        DECIMAL NUMBER SEQUENCES
        -->

        <h3>Decimal Number Sequences</h3>
        <form class="form-horizontal">
            <div class="form-group">
                <div class="col-sm-offset-2 col-sm-10">
                    <i>Generate a list of values between "Start" and "End", incrementing by "Step".  For example, for Start=1.1, End=6, Step=1.5, this will generate [1.1, 2.6, 4.1, 5.6]</i>
                </div>
            </div>
            <div class="form-group">
                <label class="control-label col-sm-2" for="decimal-number-range-name">Field Name:</label>
                <div class="col-sm-10">
                    <input type="text" class="form-control" id="decimal-number-range-name" value="Number">
                </div>
            </div>
            <div class="form-group">
                <label class="control-label col-sm-2" for="decimal-number-range-description">Field Description:</label>
                <div class="col-sm-10">
                    <input type="text" class="form-control" id="decimal-number-range-description" value="A generated number sequence">
                </div>
            </div>
            <div class="form-group">
                <label class="control-label col-sm-2" for="decimal-number-range-start">Start:</label>
                <div class="col-sm-10">
                    <input type="text" class="form-control" id="decimal-number-range-start" value="1.1">
                </div>
            </div>
            <div class="form-group">
                <label class="control-label col-sm-2" for="decimal-number-range-end">End:</label>
                <div class="col-sm-10">
                    <input type="text" class="form-control" id="decimal-number-range-end" value="6">
                </div>
            </div>
            <div class="form-group">
                <label class="control-label col-sm-2" for="decimal-number-range-step">Step:</label>
                <div class="col-sm-10">
                    <input type="text" class="form-control" id="decimal-number-range-step" value="1.5">
                </div>
            </div>
            <div class="form-group">
                <div class="col-sm-offset-2 col-sm-10">
                    <button type="button" id="submit-decimal-number-range" class="btn btn-default">Create</button>
                </div>
            </div>
        </form>
    </div>
</body>
</html>
