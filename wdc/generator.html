<html>
<head>
    <title>USGS Earthquake Feed</title>
    <meta http-equiv="Cache-Control" content="no-store" />

    <link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-1q8mTJOASx8j1Au+a5WDVnPi2lkFfwwEAa8hDDdjZlpLegxhjVME1fgjWPGmkzs7" crossorigin="anonymous">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js" type="text/javascript"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js" integrity="sha384-0mSbJDEHialfmuBBQP6A4Qrprq5OVfW37PRR3j5ELqxss1yVqOtnepnHVP9aJ7xS" crossorigin="anonymous"></script>

    <script src="https://connectors.tableau.com/libs/tableauwdc-2.0.latest.js" type="text/javascript"></script>
    <script>
(function() {
    // Create the connector object
    var myConnector = tableau.makeConnector();

    // Define the schema
    myConnector.getSchema = function(schemaCallback) {
        var config = JSON.parse(tableau.connectionData);

        if(config.type === "wholeNumberRange") {
            schemaCallback([{
                id: "wholeNumberRange",
                alias: "Range of whole numbers",
                columns: [{
                             id: "number",
                             alias: "A number",
                             dataType: tableau.dataTypeEnum.int
                         }]
            }]);
        }
    };

    // Download the data
    myConnector.getData = function(table, doneCallback) {
        var config = JSON.parse(tableau.connectionData);

        if(config.type === "wholeNumberRange") {
            var tableData = [];
            for(var i = config.start; i <= config.end; i += config.step) {
                tableData.push({"number": i});
            }
            table.appendRows(tableData);
            doneCallback();
        } 
    };

    tableau.registerConnector(myConnector);

    // Create event listeners for when the user submits the form
    $(document).ready(function() {
        $("#submit-whole-number-range").click(function() {
            var rangeStart = parseInt($("#whole-number-range-start").val()); 
            var rangeEnd = parseInt($("#whole-number-range-end").val()); 
            var rangeStep = parseInt($("#whole-number-range-step").val()); 
            tableau.connectionName = "" + rangeStart + ":" + rangeEnd + ":" + rangeStep;
            tableau.connectionData = JSON.stringify({"type": "wholeNumberRange", "start": rangeStart, "end": rangeEnd, "step": rangeStep})
            tableau.submit();
        });
    });
})();
    </script>
</head>

<body>
    <div class="container container-table">
        <h3>Whole Number Sequences</h3>
        <form class="form-horizontal">
            <div class="form-group">
                <div class="col-sm-offset-2 col-sm-10">
                    <i>Generate a list of values between "Start" and "End", incrementing by "Step".  For example, for Start=1, End=6, Step=2, this will generate [1, 3, 5]</i>
                </div>
            </div>
            <div class="form-group">
                <label class="control-label col-sm-2" for="whole-number-range-start">Start:</label>
                <div class="col-sm-10">
                    <input type="text" class="form-control" id="whole-number-range-start" value="1">
                </div>
            </div>
            <div class="form-group">
                <label class="control-label col-sm-2" for="whole-number-range-end">End:</label>
                <div class="col-sm-10">
                    <input type="text" class="form-control" id="whole-number-range-end" value="100">
                </div>
            </div>
            <div class="form-group">
                <label class="control-label col-sm-2" for="whole-number-range-step">Step:</label>
                <div class="col-sm-10">
                    <input type="text" class="form-control" id="whole-number-range-step" value="1">
                </div>
            </div>
            <div class="form-group">
                <div class="col-sm-offset-2 col-sm-10">
                    <button type="button" id="submit-whole-number-range" class="btn btn-default">Create</button>
                </div>
            </div>
        </form>
    </div>
</body>
</html>
